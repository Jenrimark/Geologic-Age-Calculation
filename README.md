# Geologic Age Calculation

本项目用于对xlsx表格文件进行自动化处理和数据分析，支持批量读取、修改、导出等功能。

## 项目简介

这是一个专门用于地质年代数据处理的工具，能够根据输入的年代值，通过插值计算或直接匹配的方式，从标准地质年代表中获取对应的IUGS（国际地质科学联合会）2023.9版本的年代数据。

## 功能特性

- 📊 **多格式支持**: 支持Python和R两种实现版本
- 🔍 **智能匹配**: 支持精确匹配和插值计算两种处理方式
- 📈 **可视化展示**: 自动生成彩色表格图像，便于查看结果
- 💾 **数据回写**: 处理结果自动写回原Excel文件
- 🌐 **中文支持**: 完整支持中文字体显示
- 🔄 **批量处理**: 支持批量处理多个年代数据

## 项目结构

```
Geologic Age Calculation/
├── README.md           # 项目说明文档
├── main.py            # Python版本主程序
├── main.R             # R语言版本主程序
├── .gitignore         # Git忽略文件配置
├── wjy.xlsx           # 标准地质年代表数据（需要用户提供）
└── docs/              # 文档和示例图片
    ├── workflow.png   # 工作流程图
    ├── result_table.png # 结果表格示例
    └── interface.png  # 用户界面示例
```

## 安装要求

### Python版本
```bash
pip install pandas matplotlib openpyxl
```

### R语言版本
```r
install.packages(c("readxl", "dplyr", "writexl", "tibble"))
```

## 使用方法

### 1. 准备数据文件
- 确保有标准地质年代表文件 `wjy.xlsx`
- 准备包含待处理年代数据的Excel文件

### 2. 运行程序

**Python版本:**
```bash
python main.py
```

**R语言版本:**
```bash
Rscript main.R
```

### 3. 交互式操作流程

1. **选择年代表版本**: 从主数据表中选择要使用的年代表版本
2. **输入数据文件路径**: 指定包含年代数据的Excel文件
3. **选择年代列**: 指定文件中包含年代数据的列名
4. **自动处理**: 程序自动处理所有年代数据并生成结果

## 处理逻辑

### 数据匹配策略
1. **精确匹配**: 优先寻找完全匹配的年代值
2. **数值插值**: 对于数值型年代，使用线性插值计算IUGS值
3. **最近邻匹配**: 当插值失败时，寻找最接近的年代值

### 输出格式
处理结果包含以下字段：
- 宇、界、系、统、阶（地质时期分级）
- 选定的年代表版本列
- IUGS 2023.9 值（原始或插值计算结果）

## 示例

### 输入数据示例
```
年代(Ma)
145.0
150.5
160.2
```

### 输出结果示例
```
宇    界      系        统      阶        GTS2020   IUGS 2023.9
显生宙 中生代  侏罗系    上侏罗统  提通阶    145.0     145.0000
显生宙 中生代  侏罗系    上侏罗统  牛津阶    150.5     150.5000
显生宙 中生代  侏罗系    中侏罗统  卡洛夫阶  160.2     160.2000
```

## 特色功能

### 可视化表格
- 自动生成彩色表格图像
- 不同列使用不同颜色标识
- 支持斑马条纹显示，提高可读性

### 数据验证
- 自动检测和处理非数值数据
- 提供详细的处理日志信息
- 错误处理和异常情况提示

### 文件操作
- 自动在原文件中添加处理结果列
- 避免列名冲突，自动生成唯一列名
- 保持原始数据完整性

## 注意事项

1. 确保 `wjy.xlsx` 文件存在且格式正确
2. 输入的年代数据应为数值格式或可转换为数值的字符串
3. 程序会自动过滤空白数据和无效数据
4. 处理结果会直接写入原Excel文件，建议提前备份

## 技术特点

- **跨平台兼容**: 支持Windows、macOS、Linux
- **内存优化**: 高效处理大型数据集
- **错误恢复**: 完善的异常处理机制
- **日志记录**: 详细的处理过程记录

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 许可证

本项目采用MIT许可证。

---

*如需技术支持或有任何问题，请通过Issue联系我们。*
